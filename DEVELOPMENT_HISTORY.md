# HordVoice v2.0 - Guide de D√©veloppement Complet avec Charte Graphique

## Vue d'ensemble du Projet
HordVoice v2.0 est un assistant vocal africain d√©velopp√© en Flutter/Dart selon l'architecture MVC avec Riverpod pour la gestion d'√©tat. L'application int√®gre de multiples services cloud et APIs pour offrir une exp√©rience d'assistant vocal compl√®te et personnalis√©e avec une interface voice-first exclusive.

## Charte Graphique - Interface Voice-First Compl√®te

### Objectif Principal
Interface **voice-first** exclusivement : aucune saisie texte dans le flux principal. L'UI ne sert que de support visuel minimal (avatar, ondes, ic√¥nes). Les interactions sont exclusivement vocales. Les textes visibles sont limit√©s aux √©crans de param√©trage et diagnostics.

### Palette de Couleurs (Usage & Sens)
- **Couleur primaire** : Bleu vif (#007AFF) - confiance, base des gradients et accents d'√©tat
- **Accent chaud** : Orange/ocre (#FF9500) - chaleur africaine, call-to-action vocal
- **Fond clair** : Tr√®s p√¢le (#FAFAFA) - pour debug/dev UI minimal
- **Fond sombre** : Bleu nuit (#1C1C1E) - mode par d√©faut si mode sombre activ√©
- **Couleurs √©motionnelles** mapp√©es sur √©tats :
  - Joie : Jaune chaud (#FFD60A)
  - Tristesse : Bleu profond (#0A84FF)
  - Col√®re : Rouge vif (#FF453A)
  - Calme : Vert doux (#30D158)
  - Surprise : Orange vif (#FF6B35)
  - Peur : Violet (#6C5CE7)
  - D√©go√ªt : Vert turquoise (#00B894)

**Explication :** Les couleurs √©motionnelles pilotent l'aura autour de l'avatar et la teinte du gradient du fond, jamais du texte vocal.

### Typographie (Usage Minimal)
- **Police principale** : Inter ou Poppins
- **Niveaux** : H1 28sp (titres param√®tres), H2 20sp (sections param√®tres), body 16sp (m√©ta)
- **Explication :** L'app n'affiche que quelques zones textuelles (param√®tres, erreurs) avec contraste √©lev√© pour accessibilit√©.

### Layout & Spacing
- **Base spacing** : 8dp
- **Marges principales** : 16dp
- **Border radius** : 16dp pour cartes, 999dp pour avatar circulaire
- **√âl√©ments centr√©s** : Avatar toujours centr√© en √©cran d'√©coute
- **Explication :** Layout simple pour que l'utilisateur ne se perde pas ‚Äî focus sur l'√©coute.

### Avatar Vocal (√âl√©ment Central)
- **Forme** : Cercle anim√© avec expressions faciales compl√®tes
- **Composants visibles** : Aur√©ole (couleur emotion), yeux expressifs, bouche r√©active, sourcils mobiles
- **Inputs d'animation** : emotion (enum), intensity (0.0-1.0), speaking (bool), scream (trigger)
- **R√©actions √©motionnelles d√©taill√©es** :
  - Joie ‚Üí sourire lumineux, yeux p√©tillants, sourcils relev√©s
  - Col√®re ‚Üí sourcils fronc√©s, expression ferm√©e, bouche serr√©e
  - Tristesse ‚Üí regard tombant, bouche triste, sourcils affaiss√©s
  - Calme ‚Üí respiration lente, yeux doux, expression sereine
  - Surprise ‚Üí yeux √©carquill√©s, bouche ouverte, sourcils lev√©s
  - Peur ‚Üí yeux pliss√©s, expression tendue
  - D√©go√ªt ‚Üí nez pliss√©, bouche ferm√©e
- **Adaptation temporelle** :
  - Matin (6h-12h) ‚Üí couleurs chaudes, visage d√©tendu, √©nergie douce
  - Apr√®s-midi (12h-18h) ‚Üí visage vif, dynamique, couleurs vives
  - Soir (18h-22h) ‚Üí couleurs douces, expression relax√©e
  - Nuit (22h-6h) ‚Üí lumi√®re douce, yeux plus ferm√©s, teintes sombres
- **Interactions tactiles compl√®tes** :
  - Tap ‚Üí petit clin d'≈ìil avec effet de ripple
  - Double tap ‚Üí grand sourire avec double cercle concentrique
  - Appui long ‚Üí frisson ou rire (chatouille) avec effet sparkle autour
  - Swipe ‚Üí r√©action de balayage (√† impl√©menter)
- **Pr√©sence permanente** :
  - Clignement al√©atoire des yeux (2-6 secondes)
  - Micro-mouvements de t√™te subtils
  - Respiration subtile continue (4 secondes cycle)
  - Transitions fluides entre √©motions (300ms)

### Waveform & Feedback Audio
- **Waveform lin√©aire** en bas de l'√©cran (20 barres, 3dp largeur, 2dp espacement)
- **Waveform circulaire** en option autour de l'avatar (32 segments)
- **Animation** li√©e au niveau RMS audio et √† l'activit√© du micro
- **Couleurs** synchronis√©es avec l'√©motion d√©tect√©e
- **Intensit√©** bas√©e sur niveau audio avec variations sinuso√Ødales
- **Explication :** Sert de feedback ¬´ j'√©coute ¬ª sans texte

### Iconographie & Micro-interactions
- **Ic√¥nes** lin√©aires, rondes, voyantes mais simples (Material Design)
- **Micro-interactions** : pulses d'avatar, transitions de gradient, micro-vibrations mat√©rielles
- **Feedback haptique** syst√©matique pour confirmations (HapticFeedback.lightImpact)
- **Explication :** Tout feedback doit √™tre perceptible sans lire

### Motion / Animations
- **Dur√©es** : court=120‚Äì200ms, moyen=300‚Äì450ms, long=600‚Äì900ms
- **Easing** : easeOutCubic pour sorties, easeInOut pour boucles
- **Option** ¬´ r√©duire les animations ¬ª obligatoire pour accessibilit√©
- **Explication :** Animations fluides mais pas distrayantes

### Accessibilit√©
- **Ratio contraste** >= 4.5:1 pour textes param√®tres
- **Sortie sonore** + vibration pour toutes confirmations
- **Option** pour d√©sactiver effets visuels forts
- **Support malvoyants** : navigation enti√®rement vocale
- **Explication :** L'app doit rester utilisable pour malvoyants ; la voix est la voie principale

### Assets & Formats
- **Animations avatar** : Custom Paint pour expressions faciales (performance optimale)
- **Ic√¥nes** : Material Icons et SVG personnalis√©s
- **Sons** : formats compress√©s sans perte excessive (ogg/mp3) pour TTS & prompts
- **Explication :** Performance et taille de l'apk optimis√©es

## Syst√®me de Voix IA Avanc√©

### Voix Pr√©d√©finies (8 voix disponibles)
| ID | Nom | Genre | Style | Langue | Description |
|---|---|---|---|---|---|
| voice_fr_smooth_f | Clara | F√©minin | Doux | FR | Voix fran√ßaise f√©minine douce et apaisante |
| voice_fr_smooth_m | Hugo | Masculin | Doux | FR | Voix fran√ßaise masculine douce et rassurante |
| voice_fr_expressive_f | Emma | F√©minin | Expressif | FR | Voix fran√ßaise f√©minine expressive et dynamique |
| voice_fr_expressive_m | Lucas | Masculin | Expressif | FR | Voix fran√ßaise masculine expressive et √©nergique |
| voice_en_calm_f | Sophie | F√©minin | Calme | EN | Voix anglaise f√©minine calme et professionnelle |
| voice_en_calm_m | James | Masculin | Calme | EN | Voix anglaise masculine calme et pos√©e |
| voice_en_vibrant_f | Mia | F√©minin | √ânergique | EN | Voix anglaise f√©minine √©nergique et enjou√©e |
| voice_en_vibrant_m | Leo | Masculin | √ânergique | EN | Voix anglaise masculine √©nergique et motivante |

### Interface de S√©lection Vocale
- **Menu d√©roulant** dans les param√®tres avec aper√ßu audio
- **Bouton "√©couter un √©chantillon"** pour chaque voix
- **Stockage du choix** via Riverpod provider (VoiceSettingsNotifier)
- **Interface responsive** avec indicateurs visuels de s√©lection
- **Support Premium** : badges pour voix payantes futures

### Param√®tres Vocaux Avanc√©s
- **Vitesse de parole** : 0.5x √† 2.0x (slider 15 divisions)
- **Volume** : 0% √† 100% (slider 10 divisions)
- **Hauteur de voix** : 50% √† 200% (slider 15 divisions)
- **Ton √©motionnel** : Adapter la voix aux √©motions d√©tect√©es
- **Accent africain** : Utiliser un accent africain authentique
- **Proverbes** : Inclure des proverbes africains dans les r√©ponses
- **Traduction automatique** : Traduire dans d'autres langues

### Extension du Syst√®me (Guide D√©veloppeurs)
**Backend :**
1. Ajouter nouveaux fichiers vocaux/r√©f√©rences API dans base de donn√©es
2. Donner ID unique, nom lisible et m√©tadonn√©es (genre, style)
3. Support ElevenLabs, Azure TTS, Google TTS

**Frontend (Flutter) :**
1. √âtendre la liste dans VoiceLibrary.predefinedVoices
2. Exemple : `VoiceOption(id: 'voice_jp_cute_f', name: 'Aiko', language: 'jp', style: 'Kawaii')`
3. Ajouter bouton "Actualiser la liste" pour recharger depuis l'API

**UI :**
1. Liste dynamique avec ListView.builder aliment√©e par provider
2. Support scroll infini pour nombreuses voix
3. Filtres par langue/style/genre

## Principes d'UX Voice-First (R√®gles Strictes)

1. **No text input** dans le flux principal : tout slot filling par dialogue vocal
2. **Confirmation vocale** syst√©matique pour actions sensibles (appels, paiements, suppression)
3. **R√©ponses concises** (TTS) : 1 √† 2 phrases, puis option ¬´ veux-tu plus d'infos ? ¬ª
4. **Gestion des interruptions** : si l'utilisateur parle pendant la r√©ponse, interrompre la TTS et √©couter
5. **Dialogues √† trous** : pour requ√™tes n√©cessitant donn√©es (ex. cr√©ation d'√©v√©nement) : poser une question √† la fois, valider la r√©ponse
6. **Feedback non verbal** : waveform + vibration + couleur de l'aura
7. **Mode discret** : r√©ponses sonores r√©duites, haptique uniquement
8. **Onboarding vocal** : premi√®res actions et demandes d'autorisation expliqu√©es par voix et confirm√©es oralement
9. **Fallback** : si reconnaissance √©choue 3 fois, proposer relancer ou envoyer r√©sum√© dans param√®tres (textuel) pour debug

## Impl√©mentation - √âtapes Concr√®tes (UI + Pipeline Vocal)

### Partie A - Foundation UI (Flutter) ‚úÖ
1. ‚úÖ **Design Tokens** (`lib/theme/design_tokens.dart`) - Couleurs, spacing, animations, √©motions
2. ‚úÖ **App Theme** (`lib/theme/app_theme.dart`) - Th√®mes clair & sombre complets avec Material 3
3. ‚úÖ **AnimatedAvatar** (`lib/widgets/animated_avatar.dart`) - Avatar r√©actif √©motionnel avec expressions faciales
4. ‚úÖ **AudioWaveform** (`lib/widgets/audio_waveform.dart`) - Ondes audio lin√©aires et circulaires temps r√©el
5. ‚úÖ **VoiceSelector** (`lib/widgets/voice_selector.dart`) - Interface s√©lection vocale compl√®te
6. üîÑ **ListeningScreen** - √âcran principal voice-first minimal (√† impl√©menter)
7. üîÑ **QuickSettingsView** - Param√®tres accessibles vocalement (mise √† jour)

### Partie B - Pipeline Audio & Reconnaissance üîÑ
1. üîÑ **Audio Capture** - Plugin natif performant pour streaming PCM continu (Android service natif)
2. üîÑ **RMS Calculation** - Niveaux audio locaux pour waveform et d√©tection d'activit√© vocale (VAD simple)
3. üîÑ **Azure Speech SDK** - Reconnaissance continue faible latence (SDK natif via platform channels)
4. üîÑ **Wake-word** - Picovoice Porcupine pour reconnaissance locale ¬´ Hey Ric ¬ª
5. üîÑ **STT ‚Üí NLU ‚Üí TTS** - Pipeline complet : Azure Speech ‚Üí OpenAI ‚Üí Azure TTS
6. üîÑ **Interruption Handling** - Gestion dynamique des conversations avec fallback flutter_tts

### Partie C - UnifiedHordVoiceService & Providers üîÑ
1. ‚úÖ **Service Architecture** - Singleton avec tous les services int√©gr√©s
2. ‚úÖ **Riverpod Providers** - √âtat global pour voix, √©motion, audio, syst√®me
3. üîÑ **Stream Exposure** - audioLevelStream, emotionStream, stateStream, commandStream
4. üîÑ **Widget Subscription** - R√©activit√© temps r√©el pour avatar et waveform

### Partie D - Onboarding Vocal & Entra√Ænement üîÑ
1. üîÑ **Premier Lancement** - TTS guide vocal pour permissions micro
2. üîÑ **Calibration Vocale** - Mini-script enregistrement 3 phrases, hash vocal
3. üîÑ **Wake-word Personnalis√©** - Flow vocal enregistrement mot-cl√© si support√©

### Partie E - Int√©gration OAuth Sans Texte üîÑ
1. üîÑ **Spotify Device Flow** - Authorization Code Flow avec redirection navigateur
2. üîÑ **QR Code/Device Code** - √âviter champs texte : site externe ou code vocal
3. ‚úÖ **Secure Storage** - Tokens dans flutter_secure_storage

## Fonctionnalit√©s Futures (Liste + Impl√©mentation D√©taill√©e)

### 1. Reconnaissance Vocale Offline (Offline ASR)
**Pourquoi :** Latence r√©duite, disponibilit√© sans r√©seau
**Impl√©mentation :** Int√©grer mod√®le on-device (Vosk, Whisper-offline ou solution native)
**√âtapes :**
1. Benchmark mod√®les (performance vs pr√©cision vs taille)
2. Int√©grer SDK natif via plugin natif
3. Fallback logic (online if offline model fails)
4. Gestion m√©moire/CPU (charger mod√®le √† la demande)
**Estimation :** Phase 2 - 3 mois d√©veloppement

### 2. Wake-word Personnalis√© et Apprentissage
**Technologies :** Picovoice Rhino/Porcupine avec personnalisation
**√âtapes :**
1. Fournir flow vocal d'enregistrement 3-5 phrases
2. Entra√Æner/custom wake-word sur serveur ou via SDK
3. D√©ployer mod√®le personnalis√©
4. Fallback global ¬´ Hey Ric ¬ª
**Estimation :** Phase 3 - 2 mois d√©veloppement

### 3. Personnalit√©s Dynamiques √âvolutives
**Technologies :** Stocker ¬´ prompt templates ¬ª dans Supabase + r√®gles de ton
**√âtapes :**
1. Cr√©er UI de gestion (param√®tres textuels) pour r√©gler intensit√© de personnalit√©
2. C√¥t√© serveur, conserver versions et poids
3. Runtime : injecter persona prompt dans chaque requ√™te OpenAI
4. Apprentissage automatique des pr√©f√©rences utilisateur
**Estimation :** Phase 4 - 4 mois d√©veloppement

### 4. Voice Biometric Authentication (Optionnel)
**Objectif :** Permettre actions sensibles apr√®s authentification vocale
**√âtapes :**
1. Design du flow d'enrollement (10 phrases)
2. Stocker mod√®le voiceprint chiffr√© (Keystore/Keychain)
3. V√©rification au runtime, seuils de confiance
4. Option de d√©sactivation
**Estimation :** Phase 5 - 3 mois d√©veloppement

### 5. Plugins Vocaux (Syst√®me Extensible)
**Technologies :** Construire interface plugin (Dart interface + RPC)
**√âtapes :**
1. D√©finir ABI des plugins
2. Cr√©er loader dynamique (plugins sign√©s)
3. Exemples : plugin m√©t√©o local, plugin banque
4. Installer via Supabase/serveur
**Estimation :** Phase 6 - 6 mois d√©veloppement

### 6. Multilingue & Dialectes Africains
**Technologies :** Ajouter mod√®les de langue et prompts sp√©cialis√©s
**√âtapes :**
1. Collecter corpus
2. Fine-tuning prompts
3. Mapping langue selon g√©oloc ou pr√©f√©rence utilisateur
4. Fallback en fran√ßais/anglais
**Estimation :** Phase 7 - 8 mois d√©veloppement

### 7. Analytics Vocaux Anonymis√©s
**Technologies :** Logs anonymes d'intents pour am√©liorer UX
**√âtapes :**
1. Hash user id
2. Envoyer √©v√©nements minimalistes (intent, success/fail) vers serveur
3. Opt-in vocal
**Estimation :** Phase 2 - 1 mois d√©veloppement

## Gestion des Permissions - Guide D√©taill√© (Android & iOS)

### Principes G√©n√©raux
- Toujours expliquer **oralement** pourquoi on demande une permission **avant** la popup syst√®me
- Demander les permissions **progressivement** (ne pas tout demander d√®s le premier d√©marrage)
- Stocker le consentement (date + scope) et permettre retrait via commandes vocales
- G√©rer les refus : expliquer cons√©quences et proposer ¬´ autoriser via param√®tres ¬ª par voix

### Android - Listage et √âtapes

#### Permissions √† D√©clarer (AndroidManifest.xml)
- RECORD_AUDIO
- FOREGROUND_SERVICE
- WAKE_LOCK
- ACCESS_FINE_LOCATION (si navigation / m√©t√©o pr√©cise)
- BODY_SENSORS (si acc√®s sant√©)
- POST_NOTIFICATIONS (Android 13+)
- RECEIVE_BOOT_COMPLETED (si d√©marrage au boot requis)

#### Flow Recommand√©
1. Wake-word local : acc√®s micro n√©cessaire pour d√©marrage
2. Premi√®re action audio : lancer onboarding vocal expliquant pourquoi microphone
3. App via `permission_handler` demande RECORD_AUDIO. Si accord, activer wake-word
4. Si navigation demand√©e : demander location **juste avant** l'usage
5. Services background : demander FOREGROUND_SERVICE + notification persistante
6. Si refus : ¬´ tu as refus√©, veux-tu que je t'explique comment autoriser ? ¬ª ‚Üí AppSettings.openAppSettings()

#### Points Play Store
- Documenter clairement usage micro en background dans fiche Play Store
- Fournir Privacy Policy accessible et justification
- Respecter r√®gles enregistrement arri√®re-plan

### iOS - Listage et √âtapes

#### Info.plist Keys
- NSMicrophoneUsageDescription
- NSSpeechRecognitionUsageDescription
- NSLocationWhenInUseUsageDescription (si navigation)
- NSLocationAlwaysAndWhenInUseUsageDescription (si background location)
- NSHealthShareUsageDescription / NSHealthUpdateUsageDescription (si HealthKit)

#### Background Modes (Only If Necessary)
- audio (pour continuer audio sessions)
- location (si navigation en background)

#### Flow Recommand√©
1. M√™me principe : expliquer oralement avant la demande
2. Appeler `Permission.microphone.request()` ; iOS affiche popup
3. Pour background audio : configurer AVAudioSession native (category = .playAndRecord, mode = .voiceChat)
4. Enregistrements background iOS strictement contr√¥l√©s par Apple

#### Points App Store
- Fournir justification claire et privacy policy
- Enregistrements non sollicit√©s peuvent provoquer rejet

### Pratiques d'Impl√©mentation Code (Pattern)
1. **Rationale Step** (TTS) : expliquer pourquoi
2. **Request Permission** : appeler `permission_handler`
3. **Listen to Result** : if granted ‚Üí enable feature ; if denied ‚Üí voice explain
4. **If Permanently Denied** : instruire utilisateur ouvrir param√®tres via voix
5. **Log Consent** : stocker consentement chiffr√© (timestamp + scope)

## S√©curit√© des Cl√©s & Donn√©es Sensibles

### Actions Imm√©diates Requises
1. **Supprimer EnvLoader** : Ne jamais garder cl√©s Azure/Spotify dans d√©p√¥t
2. **Azure Key Vault** : Backend s√©curis√© pour d√©livrer jetons √† la demande
3. **Secure Storage Mobile** : access_token dans flutter_secure_storage
4. **CI/CD Secrets** : GitHub Actions Secrets, Azure DevOps variable groups
5. **Chiffrement Audio** : tout enregistrement local chiffr√© ; pr√©f√©rer streaming √©ph√©m√®re
6. **Privacy Policy** : accessible vocalement et dans stores

### Migration Recommand√©e
```dart
// AVANT (√† supprimer)
class EnvLoader {
  static const String _azureOpenAIKey = 'cl√©_en_dur';
}

// APR√àS (√† impl√©menter)
class SecureConfigService {
  static Future<String> getAzureOpenAIKey() async {
    final storage = FlutterSecureStorage();
    return await storage.read(key: 'azure_openai_key') ?? 
           await _fetchFromKeyVault();
  }
}
```

## Tests, Monitoring et Qualit√©

### Tests Unitaires
- Providers Riverpod (VoiceController, √©motions, audio)
- Logique de dialogue et parsers d'intent
- Mod√®les de donn√©es (VoiceOption, UserProfile)

### Tests d'Int√©gration
- End-to-end STT ‚Üí NLU ‚Üí TTS
- Pipeline audio complet avec interruptions
- OAuth flow Spotify sans texte

### Tests Appareils R√©els
- Android 8 ‚Üí 14 et iOS 14+
- Conditions r√©seau vari√©es (offline, 3G, WiFi)
- Performances animation avec diff√©rents niveaux hardware

### Monitoring
- Envoi erreurs (Sentry) anonymis√©es, opt-in vocal
- M√©triques performance pipeline audio
- Analytics usage fonctionnalit√©s (anonymis√©)

## Checklist de D√©ploiement et Conformit√©

### Documentation Stores
- ‚úÖ Privacy policy vocalement expliqu√©e dans onboarding + lien stores
- ‚úÖ Justification usage background audio/microphone pour review
- ‚úÖ Screenshots interface voice-first pour stores
- ‚úÖ Vid√©o d√©mo interactions vocales

### Conformit√© Technique
- ‚úÖ D√©sactivation facile enregistrements
- ‚úÖ Export/suppression donn√©es vocales sur demande
- ‚úÖ Tests plusieurs appareils et conditions r√©seau
- ‚úÖ Respect guidelines accessibilit√©

### Tests Finaux
- ‚úÖ Validation pipeline audio end-to-end
- ‚úÖ Test interruptions et gestion erreurs
- ‚úÖ V√©rification performances animations
- ‚úÖ Contr√¥le s√©curit√© donn√©es sensibles

## R√©sum√© Op√©rationnel - Actions Imm√©diates √† Coder

### Phase 1 : UI Voice-First (En cours ‚úÖ)
1. ‚úÖ Design tokens et th√®mes complets
2. ‚úÖ Avatar anim√© r√©actif √©motionnel
3. ‚úÖ Syst√®me de voix avec 8 options
4. ‚úÖ Waveform temps r√©el
5. üîÑ Mise √† jour HomeView avec nouveaux widgets
6. üîÑ Suppression zones saisie texte flux principal

### Phase 2 : Pipeline Audio (Suivant)
1. üîÑ Impl√©mentation wake-word local
2. üîÑ Azure Speech streaming natif
3. üîÑ Gestion interruptions TTS
4. üîÑ Onboarding vocal permissions

### Phase 3 : OAuth & S√©curit√©
1. üîÑ Spotify device flow
2. üîÑ Migration vers Key Vault
3. üîÑ Secure storage tokens
4. üîÑ Privacy policy vocale

### Phase 4 : Fonctionnalit√©s Avanc√©es
1. üîÑ Reconnaissance offline
2. üîÑ Wake-word personnalis√©
3. üîÑ Personnalit√©s √©volutives
4. üîÑ Analytics anonymis√©s

---

**√âtat Actuel :** Interface voice-first foundation compl√©t√©e ‚úÖ
**Prochaine √âtape :** Int√©gration widgets dans HomeView et pipeline audio
**Objectif Final :** Assistant vocal 100% voice-first avec avatar r√©actif √©motionnel
